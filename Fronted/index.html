<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student CRUD</title>
    <style>
        body { font-family: Arial; width: 70%; margin: auto; }
        table, th, td { border: 1px solid black; border-collapse: collapse; padding: 10px; }
        input { padding: 8px; margin: 5px; width: 200px; }
        button { padding: 8px 15px; }
    </style>
</head>
<body>

<h2>Student CRUD (HTML + JavaScript + API)</h2>

<!-- ADD / UPDATE FORM -->
<div>
    <input id="id" type="hidden">
    <input id="name" type="text" placeholder="Name">
    <input id="email" type="email" placeholder="Email">
    <input id="course" type="text" placeholder="Course">
    <button onclick="saveStudent()">Save</button>
    <button onclick="updateStudent()">Update</button>
</div>

<br>

<!-- TABLE -->
<table width="100%">
    <thead>
    <tr>
        <th>ID</th><th>Name</th><th>Email</th><th>Course</th><th>Actions</th>
    </tr>
    </thead>
    <tbody id="studentTable"></tbody>
</table>

<script>
//    const API_URL = "http://localhost:8080/api/students";
      const API_URI="https://full-442r.onrender.com/api/students"
    // Fetch All Students
    function loadStudents() {
        fetch(API_URL)
            .then(res => res.json())
            .then(data => {
                let rows = "";
                data.forEach(s => {
                    rows += `
                    <tr>
                      <td>${s.id}</td>
                      <td>${s.name}</td>
                      <td>${s.email}</td>
                      <td>${s.course}</td>
                      <td>
                        <button onclick="editStudent(${s.id})">Edit</button>
                        <button onclick="deleteStudent(${s.id})">Delete</button>
                      </td>
                    </tr>`;
                });
                document.getElementById("studentTable").innerHTML = rows;
            });
    }

    // Create Student
    function saveStudent() {
        let student = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            course: document.getElementById("course").value
        };

        fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        }).then(() => loadStudents());
    }

    // Edit Student (Fill input box)
    function editStudent(id) {
        fetch(`${API_URL}/${id}`)
            .then(res => res.json())
            .then(s => {
                document.getElementById("id").value = s.id;
                document.getElementById("name").value = s.name;
                document.getElementById("email").value = s.email;
                document.getElementById("course").value = s.course;
            });
    }

    // Update Student
    function updateStudent() {
        let id = document.getElementById("id").value;

        let student = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            course: document.getElementById("course").value
        };

        fetch(`${API_URL}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        }).then(() => loadStudents());
    }

    // Delete Student
    function deleteStudent(id) {
        if (!confirm("Delete?")) return;

        fetch(`${API_URL}/${id}`, { method: "DELETE" })
            .then(() => loadStudents());
    }

    // Load on page start
    loadStudents();
</script>

</body>
</html>
